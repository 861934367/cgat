
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Experiment.py - Tools for scripts &mdash; CGAT  documentation</title>
    
    <link rel="stylesheet" href="../_static/cgat.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sorttable.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.dataTables.min.js"></script>
    <link rel="top" title="CGAT  documentation" href="../index.html" />
    <link rel="up" title="Modules" href="../modules.html" />
    <link rel="next" title="CSV.py - Tools for parsing CSV files" href="CSV.html" />
    <link rel="prev" title="BlastAlignments.py - tools for working with alignments" href="BlastAlignments.html" />
   <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
        $('.scrollable').dataTable({
              "sScrollY":"200px",
               "sScrollX":"100%",
               "bAutoWidth":false,
               "bPaginate":false });
     });
    </script>
     

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="CSV.html" title="CSV.py - Tools for parsing CSV files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="BlastAlignments.html" title="BlastAlignments.py - tools for working with alignments"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CGAT  documentation</a> &raquo;</li>
          <li><a href="../modules.html" accesskey="U">Modules</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="module-Experiment"></span><div class="section" id="experiment-py-tools-for-scripts">
<h1>Experiment.py - Tools for scripts<a class="headerlink" href="#experiment-py-tools-for-scripts" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Andreas Heger</td>
</tr>
<tr class="field-even field"><th class="field-name">Release:</th><td class="field-body">$Id$</td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">April 02, 2014</td>
</tr>
<tr class="field-even field"><th class="field-name">Tags:</th><td class="field-body">Python</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="#module-Experiment" title="Experiment"><tt class="xref py py-mod docutils literal"><span class="pre">Experiment</span></tt></a> modules contains utility functions for logging
and record keeping of scripts.</p>
<p>This module is imported by most CGAT scripts. It provides convenient
and consistent methods for</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#record-keeping">Record keeping</a></li>
<li><a class="reference internal" href="#benchmarking">Benchmarking</a></li>
</ul>
</div></blockquote>
<p>See <a class="reference internal" href="../scripts/cgat_script_template.html"><em>&lt;no title&gt;</em></a> on how to use this module.</p>
<p>The basic usage of this module within a script is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;script_name.py - my script</span>

<span class="sd">Mode Documentation</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">optparse</span>
<span class="kn">import</span> <span class="nn">CGAT.Experiment</span> <span class="kn">as</span> <span class="nn">E</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span> <span class="n">argv</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;script main.</span>

<span class="sd">    parses command line options in sys.argv, unless *argv* is given.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">argv</span><span class="p">:</span> <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>

    <span class="c"># setup command line parser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span> <span class="n">version</span> <span class="o">=</span> <span class="s">&quot;%prog version: $Id$&quot;</span><span class="p">,</span> 
                                    <span class="n">usage</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="s">&quot;__doc__&quot;</span><span class="p">]</span> <span class="p">)</span>
                                    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-t&quot;</span><span class="p">,</span> <span class="s">&quot;--test&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s">&quot;supply help&quot;</span>  <span class="p">)</span>

    <span class="c">## add common options (-h/--help, ...) and parse command line </span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span> <span class="n">parser</span> <span class="p">)</span>

    <span class="c"># do something</span>
    <span class="c"># ...</span>
    <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;an information message&quot;</span> <span class="p">)</span>
    <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;a warning message&quot;</span><span class="p">)</span>

    <span class="c">## write footer and output benchmark information.</span>
    <span class="n">E</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="n">main</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="record-keeping">
<h2>Record keeping<a class="headerlink" href="#record-keeping" title="Permalink to this headline">¶</a></h2>
<p>The central functions in this module are the <a class="reference internal" href="#Experiment.Start" title="Experiment.Start"><tt class="xref py py-func docutils literal"><span class="pre">Start()</span></tt></a> and
<a class="reference internal" href="#Experiment.Stop" title="Experiment.Stop"><tt class="xref py py-func docutils literal"><span class="pre">Stop()</span></tt></a> methods which are called before or after any work is done 
within a script.</p>
<dl class="function">
<dt id="Experiment.Start">
<tt class="descclassname">Experiment.</tt><tt class="descname">Start</tt><span class="sig-paren">(</span><em>parser=None, argv=['/ifs/devel/michaelm/python/bin/sphinx-build', '-b', 'html', '-d', '_build/doctrees', '.', '_build/html'], quiet=False, no_parsing=False, add_csv_options=False, add_mysql_options=False, add_psql_options=False, add_pipe_options=True, add_cluster_options=False, add_output_options=False, return_parser=False</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.Start" title="Permalink to this definition">¶</a></dt>
<dd><p>set up an experiment.</p>
<p><em>param parser</em> an <tt class="xref py py-class docutils literal"><span class="pre">E.OptionParser</span></tt> instance with commandi line options.
<em>param argv</em> command line options to parse. Defaults to <a class="reference external" href="http://docs.python.org/2.7/library/sys.html#sys.argv" title="(in Python v2.7)"><tt class="xref py py-data docutils literal"><span class="pre">sys.argv</span></tt></a>
<em>quiet</em> set <a class="reference internal" href="../glossary.html#term-loglevel"><em class="xref std std-term">loglevel</em></a> to 0 - no logging
<em>no_parsing</em> do not parse command line options
<em>return_parser</em> return the parser object, no parsing
<em>add_csv_options</em> add common options for parsing <a class="reference internal" href="../glossary.html#term-tsv"><em class="xref std std-term">tsv</em></a> separated files
<em>add_mysql_options</em> add common options for connecting to <a class="reference external" href="https://mariadb.org/">mysql</a> databases
<em>add_psql_options</em> add common options for connecting to <a class="reference external" href="http://www.postgresql.org/">postgres</a> databases
<em>add_pipe_options</em> add common options for redirecting input/output
<em>add_cluster_options</em> add common options for scripts submitting jobs to the cluster
<em>add_output_options</em> add commond options for working with multiple output files
<em>returns</em> a tuple (options,args) with options (a <tt class="xref py py-class docutils literal"><span class="pre">E.OptionParser</span></tt> object</p>
<blockquote>
<div>and a list of positional arguments.</div></blockquote>
<p>The <a class="reference internal" href="#Experiment.Start" title="Experiment.Start"><tt class="xref py py-func docutils literal"><span class="pre">Start()</span></tt></a> method will also set up a file logger.</p>
<p>The default options added by this method are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">-v/--verbose</span></tt> </dt>
<dd>the <a class="reference internal" href="../glossary.html#term-loglevel"><em class="xref std std-term">loglevel</em></a></dd>
<dt><tt class="docutils literal"><span class="pre">timeit</span></tt></dt>
<dd>turn on benchmarking information and save to file</dd>
<dt><tt class="docutils literal"><span class="pre">timeit-name</span></tt></dt>
<dd>name to use for timing information,</dd>
<dt><tt class="docutils literal"><span class="pre">timeit-header</span></tt></dt>
<dd>output header for timing information.</dd>
<dt><tt class="docutils literal"><span class="pre">seed</span></tt></dt>
<dd>the random seed. If given, the python random 
number generator will be initialized with this 
seed.</dd>
</dl>
<p>Optional options added are:</p>
<p>add_csv_options</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">dialect</span></tt></dt>
<dd>csv_dialect. the default is <tt class="docutils literal"><span class="pre">excel-tab</span></tt>, defaulting to <a class="reference internal" href="../glossary.html#term-tsv"><em class="xref std std-term">tsv</em></a> formatted files.</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>add_psql_options</dt>
<dd><dl class="first last docutils">
<dt><tt class="docutils literal"><span class="pre">-C/--connection</span></tt></dt>
<dd>psql connection string</dd>
<dt><tt class="docutils literal"><span class="pre">-U/--user</span></tt></dt>
<dd>psql user name</dd>
</dl>
</dd>
<dt>add_cluster_options</dt>
<dd><dl class="first last docutils">
<dt><tt class="docutils literal"><span class="pre">--use-cluster</span></tt></dt>
<dd>use cluster</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-priority</span></tt></dt>
<dd>cluster priority to request</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-queue</span></tt></dt>
<dd>cluster queue to use</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-num-jobs</span></tt></dt>
<dd>number of jobs to submit to the cluster at the same time</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-options</span></tt></dt>
<dd>additional options to the cluster for each job.</dd>
</dl>
</dd>
<dt>add_output_options</dt>
<dd><dl class="first last docutils">
<dt><tt class="docutils literal"><span class="pre">-P/--output-filename-pattern</span></tt></dt>
<dd>Pattern to use for output filenames.</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>The <a class="reference internal" href="#Experiment.Start" title="Experiment.Start"><tt class="xref py py-func docutils literal"><span class="pre">Start()</span></tt></a> is called with an E.OptionParser object. 
<a class="reference internal" href="#Experiment.Start" title="Experiment.Start"><tt class="xref py py-func docutils literal"><span class="pre">Start()</span></tt></a> will add additional command line arguments, such as
<tt class="docutils literal"><span class="pre">--help</span></tt> for command line help or <tt class="docutils literal"><span class="pre">--verbose</span></tt> to control the <a class="reference internal" href="../glossary.html#term-loglevel"><em class="xref std std-term">loglevel</em></a>.
It can also add optional arguments for scripts needing database access,
writing to multiple output files, etc.</p>
<p><a class="reference internal" href="#Experiment.Start" title="Experiment.Start"><tt class="xref py py-func docutils literal"><span class="pre">Start()</span></tt></a> will write record keeping information to a logfile. Typically, logging
information is output on stdout, prefixed by a <cite>#</cite>, but it can be re-directed to 
a separate file. Below is a typical output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># output generated by /ifs/devel/andreas/cgat/beds2beds.py --force --exclusive --method=unmerged-combinations --output-filename-pattern=030m.intersection.tsv.dir/030m.intersection.tsv-%s.bed.gz --log=030m.intersection.tsv.log Irf5-030m-R1.bed.gz Rela-030m-R1.bed.gz</span>
<span class="c"># job started at Thu Mar 29 13:06:33 2012 on cgat150.anat.ox.ac.uk -- e1c16e80-03a1-4023-9417-f3e44e33bdcd</span>
<span class="c"># pid: 16649, system: Linux 2.6.32-220.7.1.el6.x86_64 #1 SMP Fri Feb 10 15:22:22 EST 2012 x86_64</span>
<span class="c"># exclusive                               : True</span>
<span class="c"># filename_update                         : None</span>
<span class="c"># ignore_strand                           : False</span>
<span class="c"># loglevel                                : 1</span>
<span class="c"># method                                  : unmerged-combinations</span>
<span class="c"># output_filename_pattern                 : 030m.intersection.tsv.dir/030m.intersection.tsv-%s.bed.gz</span>
<span class="c"># output_force                            : True</span>
<span class="c"># pattern_id                              : (.*).bed.gz</span>
<span class="c"># stderr                                  : &lt;open file &#39;&lt;stderr&gt;&#39;, mode &#39;w&#39; at 0x2ba70e0c2270&gt;</span>
<span class="c"># stdin                                   : &lt;open file &#39;&lt;stdin&gt;&#39;, mode &#39;r&#39; at 0x2ba70e0c2150&gt;</span>
<span class="c"># stdlog                                  : &lt;open file &#39;030m.intersection.tsv.log&#39;, mode &#39;a&#39; at 0x1f1a810&gt;</span>
<span class="c"># stdout                                  : &lt;open file &#39;&lt;stdout&gt;&#39;, mode &#39;w&#39; at 0x2ba70e0c21e0&gt;</span>
<span class="c"># timeit_file                             : None</span>
<span class="c"># timeit_header                           : None</span>
<span class="c"># timeit_name                             : all</span>
<span class="c"># tracks                                  : None</span>
</pre></div>
</div>
<p>The header contains information about:</p>
<blockquote>
<div><ul class="simple">
<li>the script name (<tt class="docutils literal"><span class="pre">beds2beds.py</span></tt>)</li>
<li>the command line options (<tt class="docutils literal"><span class="pre">--force</span> <span class="pre">--exclusive</span> <span class="pre">--method=unmerged-combinations</span> <span class="pre">--output-filename-pattern=030m.intersection.tsv.dir/030m.intersection.tsv-%s.bed.gz</span> <span class="pre">--log=030m.intersection.tsv.log</span> <span class="pre">Irf5-030m-R1.bed.gz</span> <span class="pre">Rela-030m-R1.bed.gz</span></tt>)</li>
<li>the time when the job was started (<tt class="docutils literal"><span class="pre">Thu</span> <span class="pre">Mar</span> <span class="pre">29</span> <span class="pre">13:06:33</span> <span class="pre">2012</span></tt>)</li>
<li>the location it was executed (<tt class="docutils literal"><span class="pre">cgat150.anat.ox.ac.uk</span></tt>)</li>
<li>a unique job id (<tt class="docutils literal"><span class="pre">e1c16e80-03a1-4023-9417-f3e44e33bdcd</span></tt>)</li>
<li>the pid of the job (<tt class="docutils literal"><span class="pre">16649</span></tt>)</li>
<li>the system specification (<tt class="docutils literal"><span class="pre">Linux</span> <span class="pre">2.6.32-220.7.1.el6.x86_64</span> <span class="pre">#1</span> <span class="pre">SMP</span> <span class="pre">Fri</span> <span class="pre">Feb</span> <span class="pre">10</span> <span class="pre">15:22:22</span> <span class="pre">EST</span> <span class="pre">2012</span> <span class="pre">x86_64</span></tt>)</li>
</ul>
</div></blockquote>
<p>It is followed by a list of all options that have been set in the script.</p>
<p>Once completed, a script will call the <a class="reference internal" href="#Experiment.Stop" title="Experiment.Stop"><tt class="xref py py-func docutils literal"><span class="pre">Stop()</span></tt></a> function to signify the end of the experiment.</p>
<dl class="function">
<dt id="Experiment.Stop">
<tt class="descclassname">Experiment.</tt><tt class="descname">Stop</tt><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.Stop" title="Permalink to this definition">¶</a></dt>
<dd><p>stop the experiment.</p>
</dd></dl>

<p><a class="reference internal" href="#Experiment.Stop" title="Experiment.Stop"><tt class="xref py py-func docutils literal"><span class="pre">Stop()</span></tt></a> will output to the log file that the script has concluded successfully. Below is typical output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># job finished in 11 seconds at Thu Mar 29 13:06:44 2012 -- 11.36  0.45  0.00  0.01 -- e1c16e80-03a1-4023-9417-f3e44e33bdcd</span>
</pre></div>
</div>
<p>The footer contains information about:</p>
<blockquote>
<div><ul>
<li><p class="first">the job has finished (<tt class="docutils literal"><span class="pre">job</span> <span class="pre">finished</span></tt>)</p>
</li>
<li><p class="first">the time it took to execute (<tt class="docutils literal"><span class="pre">11</span> <span class="pre">seconds</span></tt>)</p>
</li>
<li><p class="first">when it completed (<tt class="docutils literal"><span class="pre">Thu</span> <span class="pre">Mar</span> <span class="pre">29</span> <span class="pre">13:06:44</span> <span class="pre">2012</span></tt>)</p>
</li>
<li><dl class="first docutils">
<dt>some benchmarking information (<tt class="docutils literal"><span class="pre">11.36</span>&nbsp; <span class="pre">0.45</span>&nbsp; <span class="pre">0.00</span>&nbsp; <span class="pre">0.01</span></tt>) which is </dt>
<dd><p class="first last"><tt class="docutils literal"><span class="pre">user</span> <span class="pre">time</span></tt>, <tt class="docutils literal"><span class="pre">system</span> <span class="pre">time</span></tt>, <tt class="docutils literal"><span class="pre">child</span> <span class="pre">user</span> <span class="pre">time</span></tt>, <tt class="docutils literal"><span class="pre">child</span> <span class="pre">system</span> <span class="pre">time</span></tt>.</p>
</dd>
</dl>
</li>
<li><p class="first">the unique job id (<tt class="docutils literal"><span class="pre">e1c16e80-03a1-4023-9417-f3e44e33bdcd</span></tt>)</p>
</li>
</ul>
</div></blockquote>
<p>The unique job id can be used to easily retrieve matching information from a concatenation of 
log files.</p>
</div>
<div class="section" id="benchmarking">
<h2>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="complete-reference">
<h2>Complete reference<a class="headerlink" href="#complete-reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="Experiment.AppendCommaOption">
<em class="property">class </em><tt class="descclassname">Experiment.</tt><tt class="descname">AppendCommaOption</tt><span class="sig-paren">(</span><em>*opts</em>, <em>**attrs</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.AppendCommaOption" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">optparse.Option</span></tt></p>
<p>Option with additional parsing capabilities.</p>
<ul class="simple">
<li>&#8221;,&#8221; in arguments to options that have the action &#8216;append&#8217; 
are treated as a list of options. This is what galaxy does, 
but generally convenient.</li>
<li>Option values of &#8220;None&#8221; and &#8220;&#8221; are treated as default values.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="Experiment.OptionParser">
<em class="property">class </em><tt class="descclassname">Experiment.</tt><tt class="descname">OptionParser</tt><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/2.7/library/optparse.html#optparse.OptionParser" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">optparse.OptionParser</span></tt></a></p>
<p>CGAT derivative of OptionParser.</p>
<dl class="method">
<dt id="Experiment.OptionParser.add_option">
<tt class="descname">add_option</tt><span class="sig-paren">(</span><em>Option</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.add_option" title="Permalink to this definition">¶</a></dt>
<dd><p>add_option(opt_str, ..., kwarg=val, ...)</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.check_values">
<tt class="descname">check_values</tt><span class="sig-paren">(</span><em>values : Values, args : [string]</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.check_values" title="Permalink to this definition">¶</a></dt>
<dd><p>-&gt; (values : Values, args : [string])</p>
<p>Check that the supplied option values and leftover arguments are
valid.  Returns the option values and leftover arguments
(possibly adjusted, possibly completely new &#8211; whatever you
like).  Default implementation just returns the passed-in
values; subclasses may override as desired.</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.destroy">
<tt class="descname">destroy</tt><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.destroy" title="Permalink to this definition">¶</a></dt>
<dd><p>Declare that you are done with this OptionParser.  This cleans up
reference cycles so the OptionParser (and all objects referenced by
it) can be garbage-collected promptly.  After calling destroy(), the
OptionParser is unusable.</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.disable_interspersed_args">
<tt class="descname">disable_interspersed_args</tt><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.disable_interspersed_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parsing to stop on the first non-option. Use this if
you have a command processor which runs another command that
has options of its own and you want to make sure these options
don&#8217;t get confused.</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.enable_interspersed_args">
<tt class="descname">enable_interspersed_args</tt><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.enable_interspersed_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parsing to not stop on the first non-option, allowing
interspersing switches with command arguments. This is the
default behavior. See also disable_interspersed_args() and the
class documentation description of the attribute
allow_interspersed_args.</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.error">
<tt class="descname">error</tt><span class="sig-paren">(</span><em>msg : string</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.error" title="Permalink to this definition">¶</a></dt>
<dd><p>Print a usage message incorporating &#8216;msg&#8217; to stderr and exit.
If you override this in a subclass, it should not return &#8211; it
should either exit or raise an exception.</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.parse_args">
<tt class="descname">parse_args</tt><span class="sig-paren">(</span><em>args=None</em>, <em>values=None</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.parse_args" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>parse_args(args <span class="classifier-delimiter">:</span> <span class="classifier">[string] = sys.argv[1:],</span></dt>
<dd>values : Values = None)</dd>
</dl>
<p>-&gt; (values : Values, args : [string])</p>
<p>Parse the command-line options found in &#8216;args&#8217; (default:
sys.argv[1:]).  Any errors result in a call to &#8216;error()&#8217;, which
by default prints the usage message to stderr and calls
sys.exit() with an error message.  On success returns a pair
(values, args) where &#8216;values&#8217; is an Values instance (with all
your option values) and &#8216;args&#8217; is the list of arguments left
over after parsing options.</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.print_help">
<tt class="descname">print_help</tt><span class="sig-paren">(</span><em>file : file = stdout</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.print_help" title="Permalink to this definition">¶</a></dt>
<dd><p>Print an extended help message, listing all options and any
help text provided with them, to &#8216;file&#8217; (default stdout).</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.print_usage">
<tt class="descname">print_usage</tt><span class="sig-paren">(</span><em>file : file = stdout</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.print_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the usage message for the current program (self.usage) to
&#8216;file&#8217; (default stdout).  Any occurrence of the string &#8220;%prog&#8221; in
self.usage is replaced with the name of the current program
(basename of sys.argv[0]).  Does nothing if self.usage is empty
or not defined.</p>
</dd></dl>

<dl class="method">
<dt id="Experiment.OptionParser.print_version">
<tt class="descname">print_version</tt><span class="sig-paren">(</span><em>file : file = stdout</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.OptionParser.print_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the version message for this program (self.version) to
&#8216;file&#8217; (default stdout).  As with print_usage(), any occurrence
of &#8220;%prog&#8221; in self.version is replaced by the current program&#8217;s
name.  Does nothing if self.version is empty or undefined.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="Experiment.openFile">
<tt class="descclassname">Experiment.</tt><tt class="descname">openFile</tt><span class="sig-paren">(</span><em>filename</em>, <em>mode='r'</em>, <em>create_dir=False</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.openFile" title="Permalink to this definition">¶</a></dt>
<dd><p>open file in <em>filename</em> with mode <em>mode</em>.</p>
<p>If <em>create</em> is set, the directory containing filename
will be created if it does not exist.</p>
<p>gzip - compressed files are recognized by the
suffix <tt class="docutils literal"><span class="pre">.gz</span></tt> and opened transparently.</p>
<p>Note that there are differences in the file
like objects returned, for example in the
ability to seek.</p>
<p>returns a file or file-like object.</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.getHeader">
<tt class="descclassname">Experiment.</tt><tt class="descname">getHeader</tt><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.getHeader" title="Permalink to this definition">¶</a></dt>
<dd><p>return a header string with command line options and timestamp</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.getParams">
<tt class="descclassname">Experiment.</tt><tt class="descname">getParams</tt><span class="sig-paren">(</span><em>options=None</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.getParams" title="Permalink to this definition">¶</a></dt>
<dd><p>return a string containing script parameters.</p>
<p>Parameters are all variables that start with <tt class="docutils literal"><span class="pre">param_</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.getFooter">
<tt class="descclassname">Experiment.</tt><tt class="descname">getFooter</tt><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.getFooter" title="Permalink to this definition">¶</a></dt>
<dd><p>return a header string with command line options and
timestamp.</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descclassname">Experiment.</tt><tt class="descname">Start</tt><span class="sig-paren">(</span><em>parser=None, argv=['/ifs/devel/michaelm/python/bin/sphinx-build', '-b', 'html', '-d', '_build/doctrees', '.', '_build/html'], quiet=False, no_parsing=False, add_csv_options=False, add_mysql_options=False, add_psql_options=False, add_pipe_options=True, add_cluster_options=False, add_output_options=False, return_parser=False</em><span class="sig-paren">)</span></dt>
<dd><p>set up an experiment.</p>
<p><em>param parser</em> an <tt class="xref py py-class docutils literal"><span class="pre">E.OptionParser</span></tt> instance with commandi line options.
<em>param argv</em> command line options to parse. Defaults to <a class="reference external" href="http://docs.python.org/2.7/library/sys.html#sys.argv" title="(in Python v2.7)"><tt class="xref py py-data docutils literal"><span class="pre">sys.argv</span></tt></a>
<em>quiet</em> set <a class="reference internal" href="../glossary.html#term-loglevel"><em class="xref std std-term">loglevel</em></a> to 0 - no logging
<em>no_parsing</em> do not parse command line options
<em>return_parser</em> return the parser object, no parsing
<em>add_csv_options</em> add common options for parsing <a class="reference internal" href="../glossary.html#term-tsv"><em class="xref std std-term">tsv</em></a> separated files
<em>add_mysql_options</em> add common options for connecting to <a class="reference external" href="https://mariadb.org/">mysql</a> databases
<em>add_psql_options</em> add common options for connecting to <a class="reference external" href="http://www.postgresql.org/">postgres</a> databases
<em>add_pipe_options</em> add common options for redirecting input/output
<em>add_cluster_options</em> add common options for scripts submitting jobs to the cluster
<em>add_output_options</em> add commond options for working with multiple output files
<em>returns</em> a tuple (options,args) with options (a <tt class="xref py py-class docutils literal"><span class="pre">E.OptionParser</span></tt> object</p>
<blockquote>
<div>and a list of positional arguments.</div></blockquote>
<p>The <a class="reference internal" href="#Experiment.Start" title="Experiment.Start"><tt class="xref py py-func docutils literal"><span class="pre">Start()</span></tt></a> method will also set up a file logger.</p>
<p>The default options added by this method are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">-v/--verbose</span></tt> </dt>
<dd>the <a class="reference internal" href="../glossary.html#term-loglevel"><em class="xref std std-term">loglevel</em></a></dd>
<dt><tt class="docutils literal"><span class="pre">timeit</span></tt></dt>
<dd>turn on benchmarking information and save to file</dd>
<dt><tt class="docutils literal"><span class="pre">timeit-name</span></tt></dt>
<dd>name to use for timing information,</dd>
<dt><tt class="docutils literal"><span class="pre">timeit-header</span></tt></dt>
<dd>output header for timing information.</dd>
<dt><tt class="docutils literal"><span class="pre">seed</span></tt></dt>
<dd>the random seed. If given, the python random 
number generator will be initialized with this 
seed.</dd>
</dl>
<p>Optional options added are:</p>
<p>add_csv_options</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">dialect</span></tt></dt>
<dd>csv_dialect. the default is <tt class="docutils literal"><span class="pre">excel-tab</span></tt>, defaulting to <a class="reference internal" href="../glossary.html#term-tsv"><em class="xref std std-term">tsv</em></a> formatted files.</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>add_psql_options</dt>
<dd><dl class="first last docutils">
<dt><tt class="docutils literal"><span class="pre">-C/--connection</span></tt></dt>
<dd>psql connection string</dd>
<dt><tt class="docutils literal"><span class="pre">-U/--user</span></tt></dt>
<dd>psql user name</dd>
</dl>
</dd>
<dt>add_cluster_options</dt>
<dd><dl class="first last docutils">
<dt><tt class="docutils literal"><span class="pre">--use-cluster</span></tt></dt>
<dd>use cluster</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-priority</span></tt></dt>
<dd>cluster priority to request</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-queue</span></tt></dt>
<dd>cluster queue to use</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-num-jobs</span></tt></dt>
<dd>number of jobs to submit to the cluster at the same time</dd>
<dt><tt class="docutils literal"><span class="pre">--cluster-options</span></tt></dt>
<dd>additional options to the cluster for each job.</dd>
</dl>
</dd>
<dt>add_output_options</dt>
<dd><dl class="first last docutils">
<dt><tt class="docutils literal"><span class="pre">-P/--output-filename-pattern</span></tt></dt>
<dd>Pattern to use for output filenames.</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt>
<tt class="descclassname">Experiment.</tt><tt class="descname">Stop</tt><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>stop the experiment.</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.benchmark">
<tt class="descclassname">Experiment.</tt><tt class="descname">benchmark</tt><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.benchmark" title="Permalink to this definition">¶</a></dt>
<dd><p>decorator collecting wall clock time spent in decorated method.</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.cachedmethod">
<tt class="descclassname">Experiment.</tt><tt class="descname">cachedmethod</tt><span class="sig-paren">(</span><em>function</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.cachedmethod" title="Permalink to this definition">¶</a></dt>
<dd><p>decorator for caching a method.</p>
</dd></dl>

<dl class="class">
<dt id="Experiment.cachedfunction">
<em class="property">class </em><tt class="descclassname">Experiment.</tt><tt class="descname">cachedfunction</tt><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.cachedfunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>Decorator that caches a function&#8217;s return value each time it is called.
If called later with the same arguments, the cached value is returned, and
not re-evaluated.</p>
<p>Taken from <a class="reference external" href="http://wiki.python.org/moin/PythonDecoratorLibrary#Memoize">http://wiki.python.org/moin/PythonDecoratorLibrary#Memoize</a></p>
</dd></dl>

<dl class="function">
<dt id="Experiment.log">
<tt class="descclassname">Experiment.</tt><tt class="descname">log</tt><span class="sig-paren">(</span><em>loglevel</em>, <em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.log" title="Permalink to this definition">¶</a></dt>
<dd><p>log message at loglevel.</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.info">
<tt class="descclassname">Experiment.</tt><tt class="descname">info</tt><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.info" title="Permalink to this definition">¶</a></dt>
<dd><p>log information message, see the <a class="reference external" href="http://docs.python.org/2.7/library/logging.html#module-logging" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> module</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.warning">
<tt class="descclassname">Experiment.</tt><tt class="descname">warning</tt><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.warning" title="Permalink to this definition">¶</a></dt>
<dd><p>log warning message, see the <a class="reference external" href="http://docs.python.org/2.7/library/logging.html#module-logging" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> module</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.warn">
<tt class="descclassname">Experiment.</tt><tt class="descname">warn</tt><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.warn" title="Permalink to this definition">¶</a></dt>
<dd><p>log warning message, see the <a class="reference external" href="http://docs.python.org/2.7/library/logging.html#module-logging" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> module</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.debug">
<tt class="descclassname">Experiment.</tt><tt class="descname">debug</tt><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>log debugging message, see the <a class="reference external" href="http://docs.python.org/2.7/library/logging.html#module-logging" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> module</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.error">
<tt class="descclassname">Experiment.</tt><tt class="descname">error</tt><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.error" title="Permalink to this definition">¶</a></dt>
<dd><p>log error message, see the <a class="reference external" href="http://docs.python.org/2.7/library/logging.html#module-logging" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> module</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.critical">
<tt class="descclassname">Experiment.</tt><tt class="descname">critical</tt><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.critical" title="Permalink to this definition">¶</a></dt>
<dd><p>log critical message, see the <a class="reference external" href="http://docs.python.org/2.7/library/logging.html#module-logging" title="(in Python v2.7)"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> module</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.getOutputFile">
<tt class="descclassname">Experiment.</tt><tt class="descname">getOutputFile</tt><span class="sig-paren">(</span><em>section</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.getOutputFile" title="Permalink to this definition">¶</a></dt>
<dd><p>return filename to write to.</p>
</dd></dl>

<dl class="function">
<dt id="Experiment.openOutputFile">
<tt class="descclassname">Experiment.</tt><tt class="descname">openOutputFile</tt><span class="sig-paren">(</span><em>section</em>, <em>mode='w'</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.openOutputFile" title="Permalink to this definition">¶</a></dt>
<dd><p>open file for writing substituting section in the
output_pattern (if defined).</p>
<p>If the filename ends with &#8221;.gz&#8221;, the output is opened
as a gzip&#8217;ed file.</p>
</dd></dl>

<dl class="class">
<dt id="Experiment.Counter">
<em class="property">class </em><tt class="descclassname">Experiment.</tt><tt class="descname">Counter</tt><a class="headerlink" href="#Experiment.Counter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>a counter class.</p>
<p>The counter acts both as a dictionary and
a object permitting attribute access.</p>
<p>Counts are automatically initialized to 0.</p>
<p>Instantiate and use like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">input</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">c</span><span class="o">.</span><span class="n">output</span> <span class="o">+=</span> <span class="mi">2</span>
<span class="n">c</span><span class="p">[</span><span class="s">&quot;skipped&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Store data returned by function.</p>
<dl class="method">
<dt id="Experiment.Counter.asTable">
<tt class="descname">asTable</tt><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.Counter.asTable" title="Permalink to this definition">¶</a></dt>
<dd><p>return values as tab-separated table (without header).</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="Experiment.run">
<tt class="descclassname">Experiment.</tt><tt class="descname">run</tt><span class="sig-paren">(</span><em>cmd</em>, <em>return_stdout=False</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#Experiment.run" title="Permalink to this definition">¶</a></dt>
<dd><p>executed a command line cmd.</p>
<p>returns the return code.</p>
<p>If <em>return_stdout</em> is True, the contents of stdout
are returned.</p>
<p><tt class="docutils literal"><span class="pre">kwargs</span></tt> are passed on to subprocess.call or subprocess.check_output.</p>
<p>raises OSError if process failed or was terminated.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/cgat_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Experiment.py - Tools for scripts</a><ul>
<li><a class="reference internal" href="#record-keeping">Record keeping</a></li>
<li><a class="reference internal" href="#benchmarking">Benchmarking</a></li>
<li><a class="reference internal" href="#complete-reference">Complete reference</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="BlastAlignments.html"
                        title="previous chapter">BlastAlignments.py - tools for working with alignments</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="CSV.html"
                        title="next chapter">CSV.py - Tools for parsing CSV files</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/modules/Experiment.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="CSV.html" title="CSV.py - Tools for parsing CSV files"
             >next</a> |</li>
        <li class="right" >
          <a href="BlastAlignments.html" title="BlastAlignments.py - tools for working with alignments"
             >previous</a> |</li>
        <li><a href="../index.html">CGAT  documentation</a> &raquo;</li>
          <li><a href="../modules.html" >Modules</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2011, Andreas Heger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3a0.
    </div>
  </body>
</html>